---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import ToolPage from '../../layouts/ToolPage.astro';
import { slugify } from '../../utils/slug'; 

export async function getStaticPaths() {
	const tools = await getCollection('tools');
	return tools.map((tool) => ({
		params: { slug: tool.id },
		props: { tool, allTools: tools },
	}));
}

interface Props {
	tool: CollectionEntry<'tools'>;
	allTools: CollectionEntry<'tools'>[];
}

const { tool, allTools } = Astro.props;
const { Content } = await render(tool);

// Find alternatives: tools that share at least one category, excluding current tool
const toolCategorySlugs = tool.data.category.map(slugify);
const alternatives = allTools
	.filter((t) => t.id !== tool.id)
	.filter((t) => t.data.category.some((cat) => toolCategorySlugs.includes(slugify(cat))))
	.slice(0, 3);  

---

<ToolPage {...tool.data} alternatives={alternatives}>
	<Content />
</ToolPage>
